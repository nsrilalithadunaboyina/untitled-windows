<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core"
	xmlns:db="http://www.mulesoft.org/schema/mule/db"
	xmlns="http://www.mulesoft.org/schema/mule/core"
	xmlns:doc="http://www.mulesoft.org/schema/mule/documentation"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd 
http://www.mulesoft.org/schema/mule/db http://www.mulesoft.org/schema/mule/db/current/mule-db.xsd http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd">
	<flow name="dbOperations-selectQueryWithParams"
		doc:id="005ae62c-7bd6-416b-a05b-ca22499c38ee">
		<logger level="INFO" doc:name="Logger" doc:id="d8c562b1-5449-4a17-b4b4-2d31df52e727" message="#[flow.name] :: Payload ::#[payload]"/>
		<try doc:name="Try" doc:id="b11a8aae-4a01-4b4f-a3e9-d13b5e123822">
			<until-successful maxRetries="1"
				doc:name="Until Successful"
				doc:id="997ee62a-d1c0-4288-acda-4f6fdc8a1e9b" millisBetweenRetries="200">
				<db:select doc:name="Select"
					doc:id="70ecdee6-dbcb-4fed-b1b8-cd576f654d25"
					config-ref="Database_Config">
					<db:sql><![CDATA[#[payload.query]]]></db:sql>
					<db:input-parameters ><![CDATA[#[payload.params]]]></db:input-parameters>
				
</db:select>
			</until-successful>
		</try>
		<logger level="INFO" doc:name="Logger" doc:id="fd5f7441-1ef5-43f7-b33d-bcf3b4f6d5bc" message="#[flow.name] :: Payload ::#[payload]"/>
	</flow>

	<flow name="dbOperations-selectQuery"
		doc:id="d3718c02-100a-40d3-bca6-4de158538197">
		<try doc:name="Try" doc:id="27c49208-3dde-494a-be33-d3fb15f5d494">
			<until-successful maxRetries="1"
				doc:name="Until Successful"
				doc:id="fe417341-ba53-434b-84a7-7a97e0e6fdd9">
				<db:select doc:name="get Customer List"
					doc:id="9ae2068b-0580-483a-ac98-bda43beedad2"
					config-ref="Database_Config">
					<db:sql><![CDATA[#[vars.query]]]></db:sql>

				</db:select>

			</until-successful>
		</try>
	</flow>
	<flow name="updateCustomerdb-operationFlow" doc:id="ce07b17c-7dcf-426c-8a90-82acc28d6236" >
		<logger level="INFO" doc:name="Before EndUser Update" doc:id="8ce5e40b-6405-4df8-ab8d-1e6ed09d9c24" message="#[vars.sfAccountId]:: #[payload]" />
		<try doc:name="Try" doc:id="19c457c2-c3a8-41e7-b267-23d30941d181">
					<until-successful maxRetries="1" doc:name="Until Successful" doc:id="50fa1f14-8ddd-4c6f-b5ea-3468e9d54fb2" millisBetweenRetries="200">
						<db:update doc:name="UpdateCustomer" doc:id="f4fa3a9b-c6bc-461b-a55f-2edd479f0275" config-ref="Database_Config">
							<db:sql><![CDATA[#[payload.query]]]></db:sql>
							<db:input-parameters><![CDATA[#[payload.params]]]></db:input-parameters>
						</db:update>
					</until-successful>
				
</try>
		<error-handler >
			<!-- [STUDIO:"On Error Propagate"]<on-error-propagate enableNotifications="true" logException="true" doc:name="On Error Propagate" doc:id="7b08d8c4-48f1-4db6-b9b6-a42a750f2432" >
				<logger level="INFO" doc:name="Logger" doc:id="34f3437d-c7a3-42ed-8a29-cc69f648c10b" message="#[payload&#93;"/>
			</on-error-propagate> [STUDIO] -->
			<on-error-continue enableNotifications="true" logException="true" doc:name="On Error Continue" doc:id="17de068b-3490-473a-8ae2-c42d9619218b" >
					<logger level="INFO" doc:name="Logger" doc:id="7c6fe383-090b-403e-aca7-d290ed819420" message="#[payload]" />
					<ee:transform doc:name="Transform Message" doc:id="7080b1b6-1ffb-4b17-985d-f483defd2685" >
						<ee:message >
							<ee:set-payload ><![CDATA[ %dw 2.0
  output application/json
   ---
    { "id":vars.sfAccountId,
    "status": true, 
    "message": "Updated Customer Successful In Syteline"
    } ]]></ee:set-payload>
						</ee:message>
					</ee:transform>
				</on-error-continue>
		</error-handler>
	</flow>
	
	<flow name="updateEnduser-dboperation" doc:id="0dc3d7b6-d064-4886-a8bc-3a4f96c77f98">
		<logger level="INFO" doc:name="Before EndUser Update" doc:id="88e5b627-59af-4f5e-92fc-5945ca28b1bd" message="#[vars.sfAccountId]:: #[payload]" />
		<try doc:name="Try" doc:id="2e978025-4688-4d2b-b39a-ec4aa200f623" >
			<until-successful maxRetries="1" doc:name="Until Successful" doc:id="222ee01c-cf5f-4c18-9c44-65c658458ea6" millisBetweenRetries="200">
<db:update doc:name="Update EndUser" doc:id="59eaf97e-3ddc-46d2-96d4-d1a41c246072" config-ref="Database_Config">
<db:sql><![CDATA[#[payload.query]]]>
</db:sql>
<db:input-parameters><![CDATA[#[payload.params]]]>
</db:input-parameters>
</db:update>
</until-successful>
		</try>
		<error-handler >
			<!-- [STUDIO:"On Error Continue"]<on-error-continue enableNotifications="true" logException="true" doc:name="On Error Continue" doc:id="680f4791-002e-433c-8aac-436c64de8519" >
				<logger level="INFO" doc:name="Logger" doc:id="4df63261-c805-4347-b297-74ef534d172d" message="#[payload&#93;" />
				<ee:transform doc:name="Transform Message" doc:id="a3cf12f2-116c-4594-8ace-25a11c87d883">
								<ee:message>
									<ee:set-payload><![CDATA[ %dw 2.0
  output application/json
   &#45;&#45;-
    { "enduser_code": payload.params.enduser_code,
    "status": true, 
    "message": "Updated Enduser Successful In Syteline"
    } &#93;&#93;></ee:set-payload>
								</ee:message>
							</ee:transform>
			</on-error-continue> [STUDIO] -->
			<on-error-propagate enableNotifications="true" logException="true" doc:name="On Error Propagate" doc:id="92236e54-8cd0-4ac9-8713-43abdb5d8af8" >
				<logger level="INFO" doc:name="Logger" doc:id="34782f15-3f15-4799-bed9-03d271a29938" message="#[payload]"/>
			</on-error-propagate>
		</error-handler>
	</flow>
	<flow name="updateServiceorderDBOperationFlow" doc:id="eb7eb232-c90b-4c35-acbb-21b22d65bb00" >
		<logger level="INFO" doc:name="before Update Serviceorder" doc:id="84c0f2c7-00d3-4c42-8a32-a10f418e366d" message="#[vars.sfWorkOrderId]:: #[payload]]" />
		<try doc:name="Try" doc:id="356b089d-3f7d-4885-9049-c2be462260cb" >
			<until-successful maxRetries="1" doc:name="Until Successful" doc:id="2d6537cd-dbd9-4056-91d8-e98b5c6eabd6" millisBetweenRetries="30000">
					<db:update doc:name="Update ServiceOrder" doc:id="c1826fe1-fe3d-4361-b8f8-b02a46677351" config-ref="Database_Config">
					<db:sql><![CDATA[#[payload.query]]]></db:sql>
					<db:input-parameters><![CDATA[#[payload.params]]]></db:input-parameters>
				</db:update>
				</until-successful>
		</try>
		<error-handler >
			<!-- [STUDIO:"On Error Continue"]<on-error-continue enableNotifications="true" logException="true" doc:name="On Error Continue" doc:id="30920071-6467-413c-b14b-61e9da211569" >
				<logger level="INFO" doc:name="Logger" doc:id="19bdd86e-892a-4a66-9f23-7cfc649cd373" message="#[error.description&#93; :: Error Message ::  #[error.errorMessage.payload&#93;" />
				<ee:transform doc:name="Transform Message" doc:id="6d2f0816-11ee-4bae-bf3a-875a073d3d5d">
					<ee:message>
						<ee:set-payload><![CDATA[%dw 2.0
output application/json
&#45;&#45;- 
{ "id": vars.sfWorkOrderId,
"status": true, 
"message": " serviceOrder Updated Successful In Syteline"}&#93;&#93;></ee:set-payload>
					</ee:message>
				</ee:transform>
			</on-error-continue> [STUDIO] -->
			<on-error-propagate enableNotifications="true" logException="true" doc:name="On Error Propagate" doc:id="58119616-2c5d-49d6-930b-2b90de757ebd" >
				<logger level="INFO" doc:name="Logger" doc:id="79116d07-8b3e-4761-adc6-5fc66fd7253b" message="#[payload]"/>
			</on-error-propagate>
		</error-handler>
	</flow>
	<flow name="UpdateServiceorderLineItemId-DB-Operation" doc:id="2f9b356b-4866-425d-8df9-015261b7e89a" >
		<logger level="INFO" doc:name="before DB Operation" doc:id="09f99d55-ca7d-4e4f-b887-915fa446d48a" message="#[flow.name] :: Payload ::#[payload]" />
		<try doc:name="Try" doc:id="d20ae0ca-e637-4fde-bdfb-0cbbda874f3c" >
			<until-successful maxRetries="1" doc:name="Until Successful" doc:id="58ea21b9-9b53-43db-8367-34f8a1e4ab32" millisBetweenRetries="3000">
			<db:select doc:name="put Serviceorder LineItemId DB Operation" doc:id="662b3bb3-3f05-4b6f-9a06-661036d3ed1a" config-ref="Database_Config">
				<db:sql><![CDATA[ #[payload.query]]]></db:sql>
				<db:input-parameters><![CDATA[#[payload.params]]]></db:input-parameters>
			</db:select>
		</until-successful>
			<error-handler >
				<on-error-continue enableNotifications="true" logException="true" doc:name="On Error Continue" doc:id="d2e1e8fb-5886-43d6-8587-7e8981866de6" >
					<logger level="INFO" doc:name="Logger" doc:id="1fa01295-1462-45ed-8c22-99470e8c4d0c" message="#[error.description] :: Error Message ::  #[error.errorMessage.payload]" />
					<ee:transform doc:name="Transform Message" doc:id="933ca1d4-10b3-47a0-b786-85cea7285031" >
						<ee:message >
							<ee:set-payload ><![CDATA[%dw 2.0
output application/json
--- 
{ "id": vars.Sf_WoLine_Id,
"status": true, 
"message": " serviceOrderLineId Updated Successful In Syteline"}]]></ee:set-payload>
						</ee:message>
					</ee:transform>
				</on-error-continue>
			</error-handler>
		</try>
		<logger level="INFO" doc:name="after DBOperation" doc:id="2edba901-108b-4801-a567-4166e91bce96" message="#[flow.name] :: Payload ::#[payload]" />
	</flow>
	


</mule>
